<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <system.webServer>
    
    <!-- Remove trailing slashes -->
    <rewrite>
      <rules>
        <!-- Remove .html extension from URLs -->
        <rule name="Remove HTML Extension" stopProcessing="true">
          <match url="^(.*)\.html$" />
          <conditions logicalGrouping="MatchAll">
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
          </conditions>
          <action type="Redirect" url="{R:1}" redirectType="Permanent" />
        </rule>

        <!-- Rewrite .html files internally -->
        <rule name="Rewrite HTML" stopProcessing="true">
          <match url="^(.*)$" />
          <conditions logicalGrouping="MatchAll">
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
            <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
            <add input="{REQUEST_FILENAME}" pattern="^.*\..+$" negate="true" />
          </conditions>
          <action type="Rewrite" url="{R:1}.html" />
        </rule>

        <!-- Force HTTPS -->
        <rule name="Force HTTPS" stopProcessing="true">
          <match url=".*" />
          <conditions>
            <add input="{HTTPS}" pattern="^OFF$" />
          </conditions>
          <action type="Redirect" url="https://{HTTP_HOST}{REQUEST_URI}" redirectType="Permanent" />
        </rule>

        <!-- Remove www -->
        <rule name="Remove www" stopProcessing="true">
          <match url="^(.*)$" />
          <conditions>
            <add input="{HTTP_HOST}" pattern="^www\.(.*)$" />
          </conditions>
          <action type="Redirect" url="https://{C:1}{REQUEST_URI}" redirectType="Permanent" />
        </rule>
      </rules>
    </rewrite>

    <!-- HTTP Response Headers -->
    <httpProtocol>
      <customHeaders>
        <!-- Security Headers -->
        <add name="X-Content-Type-Options" value="nosniff" />
        <add name="X-Frame-Options" value="SAMEORIGIN" />
        <add name="X-XSS-Protection" value="1; mode=block" />
        <add name="Referrer-Policy" value="strict-origin-when-cross-origin" />
        
        <!-- Content Security Policy -->
        <add name="Content-Security-Policy" value="default-src 'self'; script-src 'self' https://code.jquery.com https://cdnjs.cloudflare.com https://maxcdn.bootstrapcdn.com https://cdn.jsdelivr.net https://use.fontawesome.com 'unsafe-inline'; style-src 'self' https://cdn.tailwindcss.com https://stackpath.bootstrapcdn.com https://use.fontawesome.com 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data: https://use.fontawesome.com; connect-src 'self' https://api.ipify.org https://ipapi.co https://central.captainemails.com https://checkip.amazonaws.com https://www.instabang.com;" />
        
        <!-- Remove server header -->
        <remove name="Server" />
        <remove name="X-Powered-By" />
        <remove name="X-AspNet-Version" />
        <remove name="X-AspNetMvc-Version" />
      </customHeaders>
    </httpProtocol>

    <!-- Compression -->
    <urlCompression doDynamicCompression="true" doStaticCompression="true" />

    <!-- Cache Control -->
    <staticContent>
      <!-- Images (1 year) -->
      <mimeMap fileExtension=".jpg" mimeType="image/jpeg" />
      <mimeMap fileExtension=".jpeg" mimeType="image/jpeg" />
      <mimeMap fileExtension=".png" mimeType="image/png" />
      <mimeMap fileExtension=".gif" mimeType="image/gif" />
      <mimeMap fileExtension=".webp" mimeType="image/webp" />
      <mimeMap fileExtension=".svg" mimeType="image/svg+xml" />
      
      <!-- Fonts -->
      <mimeMap fileExtension=".woff" mimeType="font/woff" />
      <mimeMap fileExtension=".woff2" mimeType="font/woff2" />
      <mimeMap fileExtension=".ttf" mimeType="font/ttf" />
      <mimeMap fileExtension=".eot" mimeType="application/vnd.ms-fontobject" />
      <mimeMap fileExtension=".otf" mimeType="font/otf" />
      
      <clientCache cacheControlMode="UseExpires" httpExpires="Sun, 29 Mar 2026 00:00:00 GMT" />
    </staticContent>

    <!-- Directory Browsing Disabled -->
    <directoryBrowse enabled="false" />

    <!-- Default Documents -->
    <defaultDocument>
      <files>
        <clear />
        <add value="index.html" />
        <add value="index.htm" />
        <add value="default.html" />
      </files>
    </defaultDocument>

    <!-- Deny Access to Sensitive Files -->
    <security>
      <fileExtensions>
        <add fileExtension=".env" allowed="false" />
        <add fileExtension=".bak" allowed="false" />
        <add fileExtension=".backup" allowed="false" />
        <add fileExtension=".sql" allowed="false" />
        <add fileExtension=".swp" allowed="false" />
      </fileExtensions>
    </security>

    <!-- Application Settings -->
    <applicationInitialization doAppInitAfterRestart="true">
      <add initializationPage="/" />
    </applicationInitialization>

  </system.webServer>

  <!-- Specify running .NET version (if applicable) -->
  <system.web>
    <compilation targetFramework="4.7.2" />
    <httpRuntime targetFramework="4.7.2" />
  </system.web>

</configuration>
